import { PureComponent } from 'react';
import PropTypes from 'prop-types';

export default class BackgroundImageOnLoad extends PureComponent {
  static propTypes = {
    src: PropTypes.string.isRequired,
    onLoadBg: PropTypes.func.isRequired,
    onError: PropTypes.func
  };
  
  unMount = false;
  
  componentDidMount() {
    if (this.props.src) {
      this.handleLoadImage(this.props);
    }
  }

  componentWillReceiveProps(nextProps) {
    if (this.props.src !== nextProps.src) {
      this.handleLoadImage(nextProps);
    }
  }
  
  componentWillUnmount(){
    this.unMount = true;
  }

  handleLoadImage = (props) => {
    const image = new Image();
    image.src = props.src;
    image.onload = () => {
      if (!this.unMount) {
        if (props.onLoadBg) {
          props.onLoadBg(image);
        }
      }
    };
    if (props.onError) {
      image.onerror = e => props.onError();
    }
  };
  
  render() {
      return null;
  }
}

